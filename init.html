<!DOCTYPE html>
<html>
<head>
    <title>åˆå§‹åŒ–æ•°æ®</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>åˆå§‹åŒ–GitHubæ•°æ®</h1>
    <button onclick="initData()">åˆå§‹åŒ–æ•°æ®</button>
    <div id="status"></div>

    <script>
        // ç®€åŒ–çš„GitHubç®¡ç†å™¨
        class DataInitializer {
            constructor() {
                this.token = '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';
                this.repo = 'zhou-str6668899/web-user-data';
                this.baseURL = 'https://api.github.com/repos/';
            }

            async updateFile(filePath, content) {
                const response = await fetch(`${this.baseURL}${this.repo}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `åˆå§‹åŒ– ${filePath}`,
                        content: btoa(JSON.stringify(content))
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                return await response.json();
            }

            async initData() {
                const status = document.getElementById('status');

                try {
                    status.innerHTML = '<div class="status">å¼€å§‹åˆå§‹åŒ–...</div>';

                    // 1. åˆ›å»ºç”¨æˆ·æ•°æ®
                    await this.updateFile('user/users.json', {
                        users: [{
                            id: "1",
                            email: "hawk@qq.com",
                            password: "123456",
                            username: "ç®¡ç†å‘˜",
                            registerDate: new Date().toISOString(),
                            lastLogin: null,
                            loginCount: 0,
                            status: "active",
                            role: "admin",
                            avatar: "",
                            verified: true
                        }]
                    });
                    status.innerHTML += '<div class="status success">âœ… ç”¨æˆ·æ•°æ®åˆ›å»ºæˆåŠŸ</div>';

                    // 2. åˆ›å»ºä¼šè¯æ•°æ®
                    await this.updateFile('sessions/active-sessions.json', {
                        sessions: []
                    });
                    status.innerHTML += '<div class="status success">âœ… ä¼šè¯æ•°æ®åˆ›å»ºæˆåŠŸ</div>';

                    // 3. åˆ›å»ºé…ç½®æ•°æ®
                    await this.updateFile('config/repository.config.json', {
                        repository: {
                            name: "web-user-data",
                            owner: "zhou-str6668899",
                            branch: "main"
                        },
                        security: {
                            adminEmails: ["hawk@qq.com"],
                            maxLoginAttempts: 5
                        }
                    });
                    status.innerHTML += '<div class="status success">âœ… é…ç½®æ•°æ®åˆ›å»ºæˆåŠŸ</div>';

                    status.innerHTML += '<div class="status success">ğŸ‰ æ‰€æœ‰æ•°æ®åˆå§‹åŒ–å®Œæˆï¼</div>';

                } catch (error) {
                    status.innerHTML += `<div class="status error">âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}</div>`;
                    console.error(error);
                }
            }
        }

        const initializer = new DataInitializer();

        function initData() {
            initializer.initData();
        }
    </script>
</body>
</html>